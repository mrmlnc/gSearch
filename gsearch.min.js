/*!
 * gSearch
 * --
 * @version: 0.2.2
 * @author: Denis Malinochkin
 * @license: MIT
 * @git: https://github.com/mrmlnc/gSearch
 */
+function(a){"use strict";a.fn.gSearch=function(c){var d=a.extend({results:!1,resultsMax:!1,rss:"/rss",liveSearch:!1,resultTemplate:'<a href="{{link}}"><h2>{{title}}</h2><span>{{creator}} - {{pubDate}}</span></a>',infoTemplate:"<p>Number of posts found: {{amount}}</p>",displaySearchInfo:!0,zeroResultsInfo:!0,descriptionLength:!1,descriptionEllipsis:!1,descriptionTags:!0,language:!1,beforeFind:!1,afterFind:!1,onComplete:!1},c);return d.results?(b.init(this,d),b):void 0};var b={isInit:!1,init:function(a,b){var c=this;this.target=a,this.results=b.results,this.resultsMax=b.resultsMax,this.rss=b.rss,this.rssData=[],this.resultTemplate=b.resultTemplate,this.infoTemplate=b.infoTemplate,this.zeroResultsInfo=b.zeroResultsInfo,this.displaySearchInfo=b.displaySearchInfo,this.descriptionLength=b.descriptionLength,this.descriptionEllipsis=b.descriptionEllipsis,this.descriptionTags=b.descriptionTags,this.beforeFind=b.beforeFind,this.afterFind=b.afterFind,this.onComplete=b.onComplete,this.idx=lunr(function(){if(b.language){if("undefined"==typeof lunr.stemmerSupport)throw new Error("Support language extensions requires Stemmer");this.use(lunr[b.language])}this.field("title",{boost:10}),this.field("creator"),this.field("description"),this.field("link"),this.field("category"),this.field("pubDate"),this.ref("id")}),a.closest("form").submit(function(b){b.preventDefault(),c.loadRSS().then(function(){c.find(a.val())})}),b.liveSearch&&a.keyup(function(){c.loadRSS().then(function(){c.find(a.val())})})},loadRSS:function(){if(this.isInit)return a.Deferred().resolve();var b=this.idx,c=this.resultsMax,d=this.rss,e=this.rssData,f=this;return a.get(d,function(d){var f=a(d).find("item"),g=f.length;c&&g>=c&&(g=c);for(var h=0;g>h;h++){for(var i=f.eq(h),j={id:h+1,title:i.find("title").text(),creator:i.find("creator").text(),description:i.find("description").text(),category:i.find("category"),pubDate:i.find("pubDate").text(),link:i.find("link").text()},k=[],l=0;l<j.category.length;l++){var m=a(j.category[l]).text();k.push(m)}j.category=k.join(", "),b.add(j),e.push(j)}}).then(function(){f.beforeFind&&f.beforeFind(e),f.isInit=!0})},find:function(b){var d=this.idx.search(b),e=a(this.results),f=[];e.empty(),this.afterFind&&this.afterFind(d),(this.zeroResultsInfo||d.length>0)&&this.displaySearchInfo&&e.append(this.format(this.infoTemplate,{amount:d.length}));for(var g=0;g<d.length;g++){var h=this.rssData[d[g].ref-1];this.descriptionTags&&"string"!=typeof this.descriptionTags||(h.description=c(h.description,this.descriptionTags)),this.descriptionLength&&(h.description=h.description.slice(0,this.descriptionLength).trim()),this.descriptionTags&&"string"!=typeof this.descriptionTags||!this.descriptionEllipsis||(h.description+=this.descriptionEllipsis),e.append(this.format(this.resultTemplate,h)),f.push(h)}this.onComplete&&this.onComplete(f)},clear:function(){a(this.results).empty(),this.target.val("")},format:function(a,b){return a.replace(/{{([^{}]*)}}/g,function(a,c){var d=b[c];return"string"==typeof d||"number"==typeof d?d:a})}},c=function(a,b){b=(((b||"")+"").toLowerCase().match(/<[a-z][a-z0-9]*>/g)||[]).join("");var c=/<\/?([a-z][a-z0-9]*)\b[^>]*>/gi,d=/<!--[\s\S]*?-->|<\?(?:php)?[\s\S]*?\?>/gi;return a.replace(d,"").replace(c,function(a,c){return b.indexOf("<"+c.toLowerCase()+">")>-1?a:""})}}(jQuery,lunr);
